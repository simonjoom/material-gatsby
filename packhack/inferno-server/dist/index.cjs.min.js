"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var C=require("inferno"),e=require("stream"),t="a runtime error occured! Use Inferno in development environment to find the error.",r=!("undefined"==typeof window||!window.document);function o(e){var t=typeof e;return"string"===t||"number"===t}function _(e){return $(e)||R(e)}function w(e){return R(e)||!1===e||D(e)||$(e)}function N(e){return"function"==typeof e}function B(e){return"string"==typeof e}function M(e){return"number"==typeof e}function R(e){return null===e}function D(e){return!0===e}function $(e){return void 0===e}function E(e){throw e||(e=t),new Error("Inferno Error: "+e)}function V(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function I(e){if(B(e))return e;var t="";for(var r in e){var n=e[r];o(n)&&(t+=r+":"+n+";")}return t}var s=new RegExp(/["'&<>]/);function O(e){if(!s.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}o<t&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var n=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i=n+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",u=new RegExp("^["+n+"]["+i+"]*$"),a={},c={};function A(e){return void 0!==c[e]||void 0===a[e]&&(u.test(e)?c[e]=!0:!(a[e]=!0))}var W=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function j(e,t,r){return e.constructor.getDerivedStateFromProps?V(r,e.constructor.getDerivedStateFromProps(t,r)):r}function J(e,t,r){var n=e.flags,o=e.type,s=e.props||C.EMPTY_OBJ,i=e.children;if(0!=(14&n)){if(4&n){var u,a=new o(s,r),c=Boolean(o.getDerivedStateFromProps);if(a.$BS=!1,a.$SSR=!0,N(a.getChildContext)&&(u=a.getChildContext()),u=_(u)?r:V(r,u),a.props===C.EMPTY_OBJ&&(a.props=s),a.context=r,!c&&N(a.componentWillMount)&&(a.$BR=!0,a.componentWillMount(),a.$BR=!1,a.$PSS)){var l=a.state,d=a.$PS;if(null===l)a.state=d;else for(var h in d)l[h]=d[h];a.$PSS=!1,a.$PS=null}c&&(a.state=j(a,s,a.state));var p=a.render(s,a.state,a.context);return w(p)?"\x3c!--!--\x3e":B(p)?O(p):M(p)?p+"":J(p,e,u)}var f=o(s,r);return w(f)?"\x3c!--!--\x3e":B(f)?O(f):M(f)?f+"":J(f,e,r)}if(0!=(481&n)){var v,m="<"+o,S=W.has(o),g=e.className;if(B(g)?m+=' class="'+O(g)+'"':M(g)&&(m+=' class="'+g+'"'),!R(s)){for(var y in s){var x=s[y];switch(y){case"dangerouslySetInnerHTML":v=x.__html;break;case"style":_(s.style)||(m+=' style="'+I(s.style)+'"');break;case"children":case"className":break;case"defaultValue":s.value||(m+=' value="'+(B(x)?O(x):x)+'"');break;case"defaultChecked":s.checked||(m+=' checked="'+x+'"');break;default:A(y)&&(B(x)?m+=" "+y+'="'+O(x)+'"':M(x)?m+=" "+y+'="'+x+'"':D(x)&&(m+=" "+y))}}"option"===o&&void 0!==s.value&&s.value===t.props.value&&(m+=" selected")}if(S)m+=">";else{m+=">";var T=e.childFlags;if(2===T)m+=J(i,e,r);else if(12&T)for(var Q=0,k=i.length;Q<k;Q++)m+=J(i[Q],e,r);else 16===T?m+=""===i?" ":O(i):v&&(m+=v);S||(m+="</"+o+">")}if(String(o).match(/[\s\n\/='"\0<>]/))throw m;return m}if(0!=(16&n))return""===i?" ":O(i);if(0!=(8192&n)){var b=e.childFlags;if(2===b)return"\x3c!--!--\x3e";if(12&b){for(var P="",F=0,$=i.length;F<$;F++)P+=J(i[F],e,r);return P}}else E();return""}function l(e){return J(e,{},{})}var d=function(t){function e(e){t.call(this),this.collector=[Infinity],this.promises=[],this.pushQueue=this.pushQueue.bind(this),e&&this.renderVNodeToQueue(e,null,null)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){setTimeout(this.pushQueue,0)},e.prototype.addToQueue=function(e,t){if(_(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},e.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||N(e))&&N(e.then)){var r=this;e.then(function(e){var t;(t=r.collector).splice.apply(t,[0,1].concat(r.promises[e])),r.promises[e]=null,setTimeout(r.pushQueue,0)}),this.collector[0]=null}else Infinity===e&&this.emit("end")},e.prototype.renderVNodeToQueue=function(e,t,r){var n=this,o=e.flags,s=e.type,i=e.props||C.EMPTY_OBJ,u=e.children;if(0<(14&o))if(4&o){var a,c=new s(i,t),l=Boolean(s.getDerivedStateFromProps);if(c.$BS=!1,c.$SSR=!0,$(c.getChildContext)||(a=c.getChildContext()),_(a)||(t=V(t,a)),c.props===C.EMPTY_OBJ&&(c.props=i),c.context=t,!l&&N(c.componentWillMount)){if(c.$BR=!0,c.componentWillMount(),c.$PSS){var d=c.state,h=c.$PS;if(null===d)c.state=h;else for(var p in h)d[p]=h[p];c.$PSS=!1,c.$PS=null}c.$BR=!1}if(N(c.getInitialProps)){var f=c.getInitialProps(c.props,c.context);if(f){if(Promise.resolve(f)===f){var v=this.promises.push([])-1;return void this.addToQueue(f.then(function(e){c.$PSS=!1,"object"==typeof e&&(c.props=V(c.props,e));var t=c.render(c.props,c.state,c.context);return w(t)?n.addToQueue("\x3c!--!--\x3e",v):B(t)?n.addToQueue(O(t),v):M(t)?n.addToQueue(t+"",v):n.renderVNodeToQueue(t,c.context,v),setTimeout(n.pushQueue,0),v}),r)}c.props=V(c.props,f)}}l&&(c.state=j(c,i,c.state));var m=c.render(c.props,c.state,c.context);c.$PSS=!1,w(m)?this.addToQueue("\x3c!--!--\x3e",r):B(m)?this.addToQueue(O(m),r):M(m)?this.addToQueue(m+"",r):this.renderVNodeToQueue(m,t,r)}else{var S=s(i,t);w(S)?this.addToQueue("\x3c!--!--\x3e",r):B(S)?this.addToQueue(O(S),r):M(S)?this.addToQueue(S+"",r):this.renderVNodeToQueue(S,t,r)}else if(0<(481&o)){var g,y="<"+s,x=W.has(s),T=e.className;if(B(T)?y+=' class="'+O(T)+'"':M(T)&&(y+=' class="'+T+'"'),!R(i))for(var Q in i){var k=i[Q];switch(Q){case"dangerouslySetInnerHTML":g=k.__html;break;case"style":_(i.style)||(y+=' style="'+I(i.style)+'"');break;case"children":case"className":break;case"defaultValue":i.value||(y+=' value="'+(B(k)?O(k):k)+'"');break;case"defaultChecked":i.checked||(y+=' checked="'+k+'"');break;default:A(Q)&&(B(k)?y+=" "+Q+'="'+O(k)+'"':M(k)?y+=" "+Q+'="'+k+'"':D(k)&&(y+=" "+Q))}}if(y+=">",String(s).match(/[\s\n\/='"\0<>]/))throw y;if(x)this.addToQueue(y,r);else{var b=e.childFlags;if(2===b)return this.addToQueue(y,r),this.renderVNodeToQueue(u,t,r),void this.addToQueue("</"+s+">",r);if(16===b)return this.addToQueue(y,r),this.addToQueue(""===u?" ":O(u+""),r),void this.addToQueue("</"+s+">",r);if(12&b){this.addToQueue(y,r);for(var P=0,F=u.length;P<F;P++)n.renderVNodeToQueue(u[P],t,r);return void this.addToQueue("</"+s+">",r)}if(g)return void this.addToQueue(y+g+"</"+s+">",r);x||this.addToQueue(y+"</"+s+">",r)}}else 0<(16&o)?this.addToQueue(""===u?" ":O(u),r):E()},e}(e.Readable);function h(e){return new d(e)}var p=Promise.resolve(),f=function(t){function e(e){t.call(this),this.started=!1,this.initNode=e}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){var t=this;this.started||(this.started=!0,p.then(function(){return t.renderNode(t.initNode,null)}).then(function(){t.push(null)}).catch(function(e){t.emit("error",e)}))},e.prototype.renderNode=function(e,t){var r=e.flags;return 0<(14&r)?this.renderComponent(e,t,4&r):0<(481&r)?this.renderElement(e,t):this.renderText(e)},e.prototype.renderComponent=function(e,o,t){var s=this,r=e.type,i=e.props;if(!t){var n=r(i,o);return w(n)?this.push("\x3c!--!--\x3e"):B(n)?this.push(O(n)):M(n)?this.push(n+""):this.renderNode(n,o)}var u,a=new r(i,o),c=Boolean(r.getDerivedStateFromProps);return a.$BS=!1,a.$SSR=!0,N(a.getChildContext)&&(u=a.getChildContext()),_(u)||(o=V(o,u)),a.context=o,a.$BR=!0,Promise.resolve(!c&&a.componentWillMount&&a.componentWillMount()).then(function(){if(a.$PSS){var e=a.state,t=a.$PS;if(null===e)a.state=t;else for(var r in t)e[r]=t[r];a.$PSS=!1,a.$PS=null}a.$BR=!1,c&&(a.state=j(a,i,a.state));var n=a.render(a.props,a.state,a.context);return a.$PSS=!1,w(n)?s.push("\x3c!--!--\x3e"):B(n)?s.push(O(n)):M(n)?s.push(n+""):s.renderNode(n,o)})},e.prototype.renderChildren=function(e,r,t){var n=this;return 2===t?this.renderNode(e,r):16===t?this.push(""===e?" ":O(e+"")):12&t?e.reduce(function(e,t){return e.then(function(){return Promise.resolve(n.renderNode(t,r)).then(function(){return!!(16&t.flags)})})},Promise.resolve(!1)):void 0},e.prototype.renderText=function(e){this.push(""===e.children?" ":O(e.children))},e.prototype.renderElement=function(e,t){var r,n=this,o=e.type,s=e.props,i="<"+o,u=W.has(o),a=e.className;if(B(a)?i+=' class="'+O(a)+'"':M(a)&&(i+=' class="'+a+'"'),!R(s))for(var c in s){var l=s[c];switch(c){case"dangerouslySetInnerHTML":r=l.__html;break;case"style":_(s.style)||(i+=' style="'+I(s.style)+'"');break;case"children":case"className":break;case"defaultValue":s.value||(i+=' value="'+(B(l)?O(l):l)+'"');break;case"defaultChecked":s.checked||(i+=' checked="'+l+'"');break;default:if(A(c)){B(l)?i+=" "+c+'="'+O(l)+'"':M(l)?i+=" "+c+'="'+l+'"':D(l)&&(i+=" "+c);break}}}if(i+=">",this.push(i),String(o).match(/[\s\n\/='"\0<>]/))throw i;if(!u){if(r)return this.push(r),void this.push("</"+o+">");var d=e.childFlags;if(1!==d)return Promise.resolve(this.renderChildren(e.children,t,d)).then(function(){n.push("</"+o+">")});this.push("</"+o+">")}},e}(e.Readable);function v(e){return new f(e)}exports.RenderQueueStream=d,exports.RenderStream=f,exports.renderToStaticMarkup=l,exports.renderToString=l,exports.streamAsStaticMarkup=v,exports.streamAsString=v,exports.streamQueueAsStaticMarkup=h,exports.streamQueueAsString=h;
